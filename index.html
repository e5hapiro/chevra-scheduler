<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Boulder Chevra Kadisha Volunteer Portal</title>
  
  <!-- Load Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Load Google Fonts: Karla (Text) and Playfair Display (Headline Substitute for Adonis/Larkin) -->
  <link href="https://fonts.googleapis.com/css2?family=Karla:ital,wght@0,200..800;1,200..800&family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">
  
  <script>
      // Configure Tailwind to use the custom colors and fonts
      tailwind.config = {
          theme: {
              extend: {
                  colors: {
                      // Backgrounds and Base Colors
                      'brand-background': '#F9F4ED', // Body BG / Lightest Color (Design #1)
                      'brand-text': '#3D4066',     // Dark Blue/Gray for Primary Text and Header BG (Design #2)
                      'brand-info-bg': '#EAE0D6', // Light Tan/Grey for Information Boxes
                      'brand-shift-border': '#C8CCCE', // Light border for shifts

                      // Action Colors
                      'brand-accent': '#0072BC',    // Blue: Active State / Borders / Secondary Action
                      'brand-signup': '#E0A960',    // Gold: Primary Action Button BG
                      'brand-full': '#F05252',      // Red for full/cancel/warning
                      'brand-cancel': '#A63A3A',    // Darker Red for cancel
                  },
                  fontFamily: {
                      headline: ['"Playfair Display"', 'serif'], // Used for titles and key text
                      text: ['Karla', 'sans-serif'],          // Used for body text
                  },
              },
          }
      }
  </script>
  <style>
      /* Apply brand background and base font globally */
      body {
          background-color: #F9F4ED; /* Background of #1 */
          color: #3D4066;
          font-family: 'Karla', sans-serif;
      }
      html, body {
          height: 100%;
          margin: 0;
          box-sizing: border-box;
      }
      /* Explicitly apply headline font for headings/titles */
      .font-headline {
          font-family: 'Playfair Display', serif;
      }
      /* Tab Content Control */
      .tab-content {
          display: none;
      }
      .tab-content.active {
          display: block;
      }
      /* Custom Tab Button Transition */
      .tab-button {
          border-bottom: 3px solid transparent;
          margin-bottom: -1px; /* To prevent double border with parent */
      }
      .tab-button.active {
          border-bottom: 3px solid #0072BC; /* brand-accent */
          color: #0072BC !important; /* brand-accent */
      }
  </style>
</head>


<body class="font-text antialiased">

  <!-- Put near the top of your <body>, but inside the main content -->
  <div id="loading-overlay" style="
    display: none;
    position: fixed;
    top: 0; left: 0; width: 100vw; height: 100vh;
    background: rgba(255,255,255,0.7);
    z-index: 1000;
    display: flex; align-items: center; justify-content: center;
  ">
    <div class="loader">
      <!-- Simple spinner, use Tailwind or a GIF/SVG for style -->
      <svg class="animate-spin h-10 w-10 text-brand-signup" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"/>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"/>
      </svg>
      <span id="loading-text" class="ml-4 text-brand-text font-semibold"></span>
    </div>
  </div>

  <div id="confirmation-dialog" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white rounded-lg p-6 max-w-md w-full shadow-lg">
      <p id="confirmation-message" class="mb-4 text-gray-900 font-semibold"></p>
      <div class="flex justify-end gap-4">
        <button id="confirm-no" class="px-4 py-2 rounded bg-gray-300 hover:bg-gray-400">No</button>
        <button id="confirm-yes" class="px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700">Yes</button>
      </div>
    </div>
  </div>

  <div id="information-dialog" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white rounded-lg p-6 max-w-md w-full shadow-lg">
      <p id="information-message" class="mb-4 text-gray-900 font-semibold"></p>
      <div class="flex justify-end">
        <button id="confirm-ok" class="px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700">OK</button>
      </div>
    </div>
  </div>

<div class="h-full flex flex-col">
    
    <!-- Header (Design #2 Structure & Style) -->
    <header class="shadow-lg bg-brand-text">
        <div class="max-w-7xl mx-auto px-6 py-8">
            <div class="flex items-center justify-between">
                <h1 class="text-3xl font-bold leading-tight text-brand-background">
                    <span class="font-headline">BOULDER CHEVRA KADISHA</span><br>
                    <span class="font-headline">Shmira Schedule</span>
                </h1>
                <div class="flex items-center gap-4">
                    <span id="welcome-message" class="font-headline text-brand-background"></span>
                    <div class="w-12 h-12 rounded-full flex items-center justify-center font-semibold text-brand-text" style="background-color: #E0A960;">
                        SM
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="flex-1 overflow-auto">
      <div class="max-w-7xl mx-auto px-6 py-8">
        <!-- Tab Navigation -->
        <div class="mb-6">
          <div class="flex gap-2 mb-0 border-b border-brand-shift-border">
            <!-- Tab buttons here (unchanged) -->
            <button onclick="switchTab('schedule')" id="tab-schedule" class="tab-button active px-6 py-3 font-semibold rounded-t-lg transition-all bg-brand-background text-brand-accent shadow-md">
              Schedule Shifts
            </button>
            <button onclick="switchTab('my-shifts')" id="tab-my-shifts" class="tab-button px-6 py-3 font-semibold rounded-t-lg transition-all bg-brand-info-bg text-brand-text/80 hover:bg-brand-background hover:text-brand-accent shadow-sm">
              My Shifts
            </button>
            <button onclick="switchTab('locations')" id="tab-locations" class="tab-button px-6 py-3 font-semibold rounded-t-lg transition-all bg-brand-info-bg text-brand-text/80 hover:bg-brand-background hover:text-brand-accent shadow-sm">
              Mortuary Information
            </button>
            <button onclick="switchTab('signups')" id="tab-signups" class="tab-button px-6 py-3 font-semibold rounded-t-lg transition-all bg-brand-info-bg text-brand-text/80 hover:bg-brand-background hover:text-brand-accent shadow-sm">
              Volunteer History
            </button>
          </div>

          <!-- Tab Content Container -->
          <div class="bg-brand-background rounded-lg shadow-md border border-t-0 border-brand-shift-border">
            <div class="p-6">

              <!-- Schedule Shifts Tab -->
              <div id="content-schedule" class="tab-content">
                <div class="flex items-center justify-between mb-6">
                  <h2 class="text-2xl font-bold font-headline text-brand-text">
                    Available Shifts
                  </h2>
                  <button id="bulk-signup-btn"
                    class="bg-brand-signup text-white py-2 px-6 rounded-lg font-bold transition-colors duration-150 hover:bg-brand-signup/90 disabled:opacity-50"
                    onclick="performBulkSignup()" disabled>
                    Sign Up for Selected Shifts
                  </button>
                </div>
                <!-- Loader -->
                <div id="available-shifts-loader" style="display:none;" class="p-6 text-center text-gray-500">Loading...</div>
                <!-- Available Shifts Grid -->
                <div class="grid gap-6" id="available-shifts-grid"></div>
              </div>

              <!-- My Shifts Tab -->
              <div id="content-my-shifts" class="tab-content">
                <div class="flex items-center justify-between mb-6">
                  <h2 class="text-2xl font-bold font-headline text-brand-text">
                    My Shifts
                  </h2>
                  <button id="bulk-unselect-btn"
                    class="bg-red-500 text-white py-2 px-6 rounded-lg font-bold transition-colors duration-150 hover:bg-red-600 disabled:opacity-50"
                    onclick="performBulkRemoval()" disabled>
                    Remove Selected Shifts
                  </button>
                </div>
                <div id="my-shifts-loader" style="display:none;" class="p-6 text-center text-gray-500">Loading...</div>
                <div class="grid gap-6" id="selected-shifts-grid"></div>
              </div>

              <!-- Mortuary Location Information Tab -->
              <div id="content-locations" class="tab-content">
                <div id="locations-loader" style="display:none;" class="p-6 text-center text-gray-500">Loading...</div>
                <div class="grid gap-6" id="locations-info-grid"></div>
              </div>

              <!-- Volunteer History Tab -->
              <div id="content-signups" class="tab-content">
                <div id="signups-loader" style="display:none;" class="p-6 text-center text-gray-500">Loading...</div>
                <div id="volunteer-history-grid"></div>
              </div>


            </div>
          </div>
        </div>
      </div>
    </main>

    <script>
      // This will be replaced by the JSON string from doGet
      const SERVER_DATA_JSON = <?= data ?>;

    </script>

    <!-- Include client-side JS from a separate HTML file -->
    <?!= include('appscript'); ?>

    <!-- Initialize to the Schedule Shifts tab on load -->
    <script>
      window.onload = init;
    </script>

</body>
</html>
